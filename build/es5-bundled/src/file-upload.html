<html><head><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="../bower_components/file-upload/file-upload-icons.html"><link rel="import" href="../bower_components/polymerfire/polymerfire.html"><link rel="import" href="../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"></head><body><dom-module id="file-upload"><template><style type="text/css">:host{display:inline-block;--error-color:#f40303;}.enabled{border:1px dashed #555;@apply (--file-upload-upload-border-enabled);}.hover{opacity:.7;border:1px dashed #111;@apply (--file-upload-upload-border-hover);}#UploadBorder{vertical-align:middle;color:#555;padding:20px;max-height:300px;overflow-y:auto;display:inline-block;@apply (--file-upload-upload-border);}#dropArea{text-align:center;@apply (--file-upload-drop-area);}paper-button#button{margin-bottom:20px;@apply (--file-upload-button);}paper-button#button:hover{@apply (--file-upload-button-hover);}.file{padding:10px 0px;@apply (--file-upload-file);}.commands{float:right;@apply (--file-upload-commands);}.commands iron-icon:not([icon="check-circle"]){cursor:pointer;opacity:.9;@apply (--file-upload-commands-faded);}.commands iron-icon:hover{opacity:1;@apply (--file-upload-commands-hovered);}[hidden]{display:none;}.error{color:var(--error-color);font-size:11px;margin-top:2px;@apply (--file-upload-error);}.progress-bar{margin-top:2px;}paper-progress{--paper-progress-active-color:#03a9f4;}paper-progress[error]{--paper-progress-active-color:var(--error-color);}</style><firebase-auth id="auth" provider="email" signed-in="{{signedIn}}" user="{{user}}" on-error="handleError"></firebase-auth><div><paper-button id="button" icon="file-upload-icons:file-upload" class="blue" on-click="_fileClick" alt="{{paperButtonAlt}}" title="{{paperButtonTitle}}"><content></content></paper-button><div id="UploadBorder" hidden$="{{hideFileList}}"><div id="dropArea" hidden$="{{!_shownDropText}}">{{dropText}}</div><template is="dom-repeat" items="{{files}}"><div class="file"><div class="name"><span>{{item.name}}</span><div class="commands"><iron-icon icon="file-upload-icons:autorenew" title="{{retryText}}" on-click="_retryUpload" hidden$="{{!item.error}}"></iron-icon><iron-icon icon="file-upload-icons:check-circle" title="{{successText}}" hidden$="{{!item.complete}}"></iron-icon></div></div><div class="error" hidden$="{{!item.error}}">{{errorText}}</div><div class="progress-bar" hidden$="{{progressHidden}}"><paper-progress value$="{{item.progress}}" error$="{{item.error}}"></paper-progress></div></div></template></div><paper-button id="button" icon="file-upload-icons:start-upload" class="blue" on-click="_manualUpload" alt="{{paperButtonAlt}}" title="{{paperButtonTitle}}"><content></content></paper-button></div><input type="file" id="fileInput" on-change="_fileChange" hidden="" multiple="{{multi}}" accept="{{accept}}"></template></dom-module><script>Polymer({is:'file-upload',properties:{target:{type:String,value:''},accept:{type:String,value:''},hideFileList:{type:Boolean,value:!1},progressHidden:{type:Boolean,value:!1},droppable:{type:Boolean,value:!1},dropText:{type:String,value:'Drop Files Here'},multi:{type:Boolean,value:!1},files:{type:Array,notify:!0,value:function(){return[]}},method:{type:String,value:'PUT'},withCredentials:{type:Boolean,value:!1},raised:{type:Boolean,value:!1},noink:{type:Boolean,value:!1},headers:{type:Object,value:{}},retryText:{type:String,value:'Retry Upload'},removeText:{type:String,value:'Remove'},successText:{type:String,value:'Success'},errorText:{type:String,value:'Error uploading file...'},_shownDropText:{type:Boolean,value:!1},additional:{type:Object,value:{}},manualUpload:{type:Boolean,value:!0},fileDataName:{type:String,value:'file'},paperButtonAlt:{type:String,value:''},paperButtonTitle:{type:String,value:''}},clear:function(){this.set('files',[]),this.$.fileInput.value='',this._showDropText()},ready:function(){this.raised&&this.toggleAttribute('raised',!0,this.$.button),this.noink&&this.toggleAttribute('noink',!0,this.$.button),this.droppable&&(this._showDropText(),this.setupDrop())},setupDrop:function(){var b=this.$.UploadBorder;this.toggleClass('enabled',!0,b),this.ondragover=function(c){c.stopPropagation(),this.toggleClass('hover',!0,b);var d=c.dataTransfer&&c.dataTransfer.dropEffect,f=c.dataTransfer&&c.dataTransfer.effectAllowed;return'none'===d&&'none'!==f&&(c.dataTransfer.dropEffect='move'===f?'move':'copy'),!1},this.ondragleave=function(){return this.toggleClass('hover',!1,b),!1},this.ondrop=function(c){if(this.toggleClass('hover',!1,b),c.preventDefault(),this.multi||0===this.files.length)for(var d=c.dataTransfer.files.length,f=0;f<d;f++){var g=c.dataTransfer.files[f],h=''===g.type?null:g.type.match(/^[^\/]*\//)[0],j=g.name.match(/\.[^\.]*$/)[0];(''===this.accept||-1<this.accept.indexOf(h)||-1<this.accept.indexOf(j))&&(g.progress=0,g.error=!1,g.complete=!1,this.push('files',g),this.manualUpload||this.uploadFile(g))}}},_fileClick:function(){var b=this.$.fileInput;if(b&&document.createEvent){var c=document.createEvent('MouseEvents');c.initEvent('click',!0,!1),b.dispatchEvent(c)}},_fileChange:function(b){for(var f,c=b.target.files.length,d=0;d<c;d++)f=b.target.files[d],f.progress=0,f.error=!1,f.complete=!1,this.multi?this.push('files',f):this.set('files',[f])},_manualUpload:function(){if(this.files)for(var f,c=this.files.length,d=0;d<c;d++)f=this.files[d],this.uploadFile(f)},cancel:function(b){if(b){var c=this.$.auth.app,d='';d='posts/'+b.name;var f=c.storage().ref(d),g=f.put(b);g.cancel(),this.splice('files',this.files.indexOf(b),1),this._showDropText()}},_cancelUpload:function(b){this.cancel(b.model.__data__.item)},_retryUpload:function(b){b.model.set('item.error',!1),b.model.set('item.progress',0);var c=this;this.async(function(){c.uploadFile(b.model.__data__.item)},50)},_showDropText:function(){this.set('_shownDropText',!this.files.length&&this.droppable)},uploadFile:function(b){if(b){this.fire('before-upload'),this._showDropText();var c='files.'+this.files.indexOf(b),d=this,f=this.$.auth.app,g='';g='posts/'+b.name;var h=f.storage().ref(g),j=h.put(b);j.on('state_changed',function(l){var m=100*(l.bytesTransferred/l.totalBytes);d.set(c+'.progress',m)},function(){d.set(c+'.error',!0),d.set(c+'.complete',!1),d.set(c+'.progress',100),d.updateStyles()},function(){d.set(c+'.complete',!0)})}}});</script></body></html>