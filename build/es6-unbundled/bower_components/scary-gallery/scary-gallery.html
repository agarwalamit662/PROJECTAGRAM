<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="scary-image.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"></head><body><dom-module id="scary-gallery"><template><style>:host{width:100%;display:flex;flex-wrap:wrap;}</style><slot></slot></template><script>Polymer({is:'scary-gallery',properties:{minHeight:{type:Number,value:200},gap:{type:Number,value:4}},observers:['_init(minHeight, gap)'],attached:function(){this._observer=Polymer.dom(this).observeNodes(this._init),this._boundResize=this._resize.bind(this),window.addEventListener('resize',this._boundResize)},detached:function(){Polymer.dom(this).unobserveNodes(this._observer),window.removeEventListener('resize',this._boundResize)},_init:function(){this.debounce('init',function(){this._firstResize=!0,this._children=Array.prototype.slice.call(Polymer.dom(this).querySelectorAll('scary-image')),this._resize()},50)},_resize:function(){this.debounce('resize',function(){var a=!0,b=[],c=[],d=0;this._maxWidth=this.offsetWidth,this._children.forEach(function(e){if(e.style.margin=(this.gap/2).toString(10)+'px',e.loaded){var f=this.minHeight/e.naturalHeight*e.naturalWidth+this.gap;d+f>this._maxWidth&&(0<c.length&&(b.push({images:c,width:d}),c=[]),d=0),d+=f,e.tmpWidth=f,c.push(e)}else a=!1}.bind(this)),0<c.length&&b.push({images:c,width:d}),b.forEach(function(e){var f=e.images.length*this.gap,g=this._maxWidth-f,h=e.width-f,i=this.minHeight*g/h;e.images.forEach(function(j){j.height=i,j.width=i/j.naturalHeight*j.naturalWidth}.bind(this))}.bind(this)),a||this._resize(),a&&this._firstResize&&(this._firstResize=!1,this._resize())},50)}});</script></dom-module></body></html>