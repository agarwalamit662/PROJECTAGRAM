<html><head><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="../bower_components/file-upload/file-upload-icons.html"><link rel="import" href="../bower_components/polymerfire/polymerfire.html"><link rel="import" href="../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="prefetch" href="../bower_components/polymer/polymer.html"><link rel="prefetch" href="../bower_components/polymer/polymer-mini.html"><link rel="prefetch" href="../bower_components/polymer/polymer-micro.html"><link rel="prefetch" href="../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="prefetch" href="../bower_components/paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../bower_components/iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../bower_components/iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../bower_components/paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../bower_components/paper-ripple/paper-ripple.html"><link rel="prefetch" href="../bower_components/paper-material/paper-material-shared-styles.html"><link rel="prefetch" href="../bower_components/paper-styles/shadow.html"><link rel="prefetch" href="../bower_components/iron-range-behavior/iron-range-behavior.html"><link rel="prefetch" href="../bower_components/paper-styles/color.html"><link rel="prefetch" href="../bower_components/iron-icon/iron-icon.html"><link rel="prefetch" href="../bower_components/iron-meta/iron-meta.html"><link rel="prefetch" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-app.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-app-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-app.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-common-behavior.html"><link rel="prefetch" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-auth-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-auth.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-database-behavior.html"><link rel="prefetch" href="../bower_components/app-storage/app-storage-behavior.html"><link rel="prefetch" href="../bower_components/promise-polyfill/promise-polyfill.html"><link rel="prefetch" href="../bower_components/promise-polyfill/promise-polyfill-lite.html"><link rel="prefetch" href="../bower_components/promise-polyfill/Promise.js"><link rel="prefetch" href="../bower_components/promise-polyfill/Promise-Statics.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-database-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-database.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-query.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-messaging.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-messaging-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-messaging.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-storage-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-storage.js"></head><body><dom-module id="file-upload"><template><style type="text/css">:host{display:inline-block;--error-color:#f40303;}.enabled{border:1px dashed #555;@apply (--file-upload-upload-border-enabled);}.hover{opacity:.7;border:1px dashed #111;@apply (--file-upload-upload-border-hover);}#UploadBorder{vertical-align:middle;color:#555;padding:20px;max-height:300px;overflow-y:auto;display:inline-block;@apply (--file-upload-upload-border);}#dropArea{text-align:center;@apply (--file-upload-drop-area);}paper-button#button{margin-bottom:20px;@apply (--file-upload-button);}paper-button#button:hover{@apply (--file-upload-button-hover);}.file{padding:10px 0px;@apply (--file-upload-file);}.commands{float:right;@apply (--file-upload-commands);}.commands iron-icon:not([icon="check-circle"]){cursor:pointer;opacity:.9;@apply (--file-upload-commands-faded);}.commands iron-icon:hover{opacity:1;@apply (--file-upload-commands-hovered);}[hidden]{display:none;}.error{color:var(--error-color);font-size:11px;margin-top:2px;@apply (--file-upload-error);}.progress-bar{margin-top:2px;}paper-progress{--paper-progress-active-color:#03a9f4;}paper-progress[error]{--paper-progress-active-color:var(--error-color);}</style><firebase-auth id="auth" provider="email" signed-in="{{signedIn}}" user="{{user}}" on-error="handleError"></firebase-auth><div><paper-button id="button" icon="file-upload-icons:file-upload" class="blue" on-click="_fileClick" alt="{{paperButtonAlt}}" title="{{paperButtonTitle}}"><content></content></paper-button><div id="UploadBorder" hidden$="{{hideFileList}}"><div id="dropArea" hidden$="{{!_shownDropText}}">{{dropText}}</div><template is="dom-repeat" items="{{files}}"><div class="file"><div class="name"><span>{{item.name}}</span><div class="commands"><iron-icon icon="file-upload-icons:autorenew" title="{{retryText}}" on-click="_retryUpload" hidden$="{{!item.error}}"></iron-icon><iron-icon icon="file-upload-icons:check-circle" title="{{successText}}" hidden$="{{!item.complete}}"></iron-icon></div></div><div class="error" hidden$="{{!item.error}}">{{errorText}}</div><div class="progress-bar" hidden$="{{progressHidden}}"><paper-progress value$="{{item.progress}}" error$="{{item.error}}"></paper-progress></div></div></template></div><paper-button id="button" icon="file-upload-icons:start-upload" class="blue" on-click="_manualUpload" alt="{{paperButtonAlt}}" title="{{paperButtonTitle}}"><content></content></paper-button></div><input type="file" id="fileInput" on-change="_fileChange" hidden="" multiple="{{multi}}" accept="{{accept}}"></template></dom-module><script>Polymer({is:'file-upload',properties:{target:{type:String,value:''},accept:{type:String,value:''},hideFileList:{type:Boolean,value:!1},progressHidden:{type:Boolean,value:!1},droppable:{type:Boolean,value:!1},dropText:{type:String,value:'Drop Files Here'},multi:{type:Boolean,value:!1},files:{type:Array,notify:!0,value:function(){return[]}},method:{type:String,value:'PUT'},withCredentials:{type:Boolean,value:!1},raised:{type:Boolean,value:!1},noink:{type:Boolean,value:!1},headers:{type:Object,value:{}},retryText:{type:String,value:'Retry Upload'},removeText:{type:String,value:'Remove'},successText:{type:String,value:'Success'},errorText:{type:String,value:'Error uploading file...'},_shownDropText:{type:Boolean,value:!1},additional:{type:Object,value:{}},manualUpload:{type:Boolean,value:!0},fileDataName:{type:String,value:'file'},paperButtonAlt:{type:String,value:''},paperButtonTitle:{type:String,value:''}},clear:function(){this.set('files',[]),this.$.fileInput.value='',this._showDropText()},ready:function(){this.raised&&this.toggleAttribute('raised',!0,this.$.button),this.noink&&this.toggleAttribute('noink',!0,this.$.button),this.droppable&&(this._showDropText(),this.setupDrop())},setupDrop:function(){var a=this.$.UploadBorder;this.toggleClass('enabled',!0,a),this.ondragover=function(b){b.stopPropagation(),this.toggleClass('hover',!0,a);var c=b.dataTransfer&&b.dataTransfer.dropEffect,d=b.dataTransfer&&b.dataTransfer.effectAllowed;return'none'===c&&'none'!==d&&(b.dataTransfer.dropEffect='move'===d?'move':'copy'),!1},this.ondragleave=function(){return this.toggleClass('hover',!1,a),!1},this.ondrop=function(b){if(this.toggleClass('hover',!1,a),b.preventDefault(),this.multi||0===this.files.length)for(var c=b.dataTransfer.files.length,d=0;d<c;d++){var f=b.dataTransfer.files[d],g=''===f.type?null:f.type.match(/^[^\/]*\//)[0],h=f.name.match(/\.[^\.]*$/)[0];(''===this.accept||-1<this.accept.indexOf(g)||-1<this.accept.indexOf(h))&&(f.progress=0,f.error=!1,f.complete=!1,this.push('files',f),this.manualUpload||this.uploadFile(f))}}},_fileClick:function(){var a=this.$.fileInput;if(a&&document.createEvent){var b=document.createEvent('MouseEvents');b.initEvent('click',!0,!1),a.dispatchEvent(b)}},_fileChange:function(a){for(var d,b=a.target.files.length,c=0;c<b;c++)d=a.target.files[c],d.progress=0,d.error=!1,d.complete=!1,this.multi?this.push('files',d):this.set('files',[d])},_manualUpload:function(){if(this.files)for(var d,b=this.files.length,c=0;c<b;c++)d=this.files[c],this.uploadFile(d)},cancel:function(a){if(a){var b=this.$.auth.app,c='';c='posts/'+a.name;var d=b.storage().ref(c),f=d.put(a);f.cancel(),this.splice('files',this.files.indexOf(a),1),this._showDropText()}},_cancelUpload:function(a){this.cancel(a.model.__data__.item)},_retryUpload:function(a){a.model.set('item.error',!1),a.model.set('item.progress',0);var b=this;this.async(function(){b.uploadFile(a.model.__data__.item)},50)},_showDropText:function(){this.set('_shownDropText',!this.files.length&&this.droppable)},uploadFile:function(a){if(a){this.fire('before-upload'),this._showDropText();var b='files.'+this.files.indexOf(a),c=this,d=this.$.auth.app,f='';f='posts/'+a.name;var g=d.storage().ref(f),h=g.put(a);h.on('state_changed',function(k){var l=100*(k.bytesTransferred/k.totalBytes);c.set(b+'.progress',l)},function(){c.set(b+'.error',!0),c.set(b+'.complete',!1),c.set(b+'.progress',100),c.updateStyles()},function(){c.set(b+'.complete',!0)})}}});</script></body></html>