<html><head><link rel="import" href="../bower_components/polymerfire/polymerfire.html"><link rel="import" href="../bower_components/app-route/app-route.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html"><link rel="import" href="../bower_components/app-layout/app-header/app-header.html"><link rel="import" href="../bower_components/app-layout/app-scroll-effects/effects/waterfall.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"><link rel="import" href="../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="import" href="shop-button.html"><link rel="import" href="shop-common-styles.html"><link rel="import" href="shop-form-styles.html"><link rel="import" href="shop-input.html"><link rel="import" href="shop-select.html"><link rel="import" href="shop-checkbox.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-progress/paper-progress.html"><link rel="import" href="../bower_components/file-upload/file-upload-icons.html"><link rel="import" href="../bower_components/polymerfire/firebase-auth.html"><link rel="import" href="../bower_components/polymerfire/firebase-document.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-app.html"><link rel="prefetch" href="../bower_components/polymer/polymer.html"><link rel="prefetch" href="../bower_components/polymer/polymer-mini.html"><link rel="prefetch" href="../bower_components/polymer/polymer-micro.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-app-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-app.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-common-behavior.html"><link rel="prefetch" href="../bower_components/app-storage/app-network-status-behavior.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-auth-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-auth.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-database-behavior.html"><link rel="prefetch" href="../bower_components/app-storage/app-storage-behavior.html"><link rel="prefetch" href="../bower_components/promise-polyfill/promise-polyfill.html"><link rel="prefetch" href="../bower_components/promise-polyfill/promise-polyfill-lite.html"><link rel="prefetch" href="../bower_components/promise-polyfill/Promise.js"><link rel="prefetch" href="../bower_components/promise-polyfill/Promise-Statics.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-database-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-database.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-query.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-messaging.html"><link rel="prefetch" href="../bower_components/polymerfire/firebase-messaging-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-messaging.js"><link rel="prefetch" href="../bower_components/polymerfire/firebase-storage-script.html"><link rel="prefetch" href="../bower_components/firebase/firebase-storage.js"><link rel="prefetch" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror-client.html"><link rel="prefetch" href="../bower_components/app-storage/app-indexeddb-mirror/common-worker.html"><link rel="prefetch" href="../bower_components/iron-resizable-behavior/iron-resizable-behavior.html"><link rel="prefetch" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects-behavior.html"><link rel="prefetch" href="../bower_components/iron-scroll-target-behavior/iron-scroll-target-behavior.html"><link rel="prefetch" href="../bower_components/app-layout/helpers/helpers.html"><link rel="prefetch" href="../bower_components/iron-icon/iron-icon.html"><link rel="prefetch" href="../bower_components/iron-meta/iron-meta.html"><link rel="prefetch" href="../bower_components/paper-behaviors/paper-inky-focus-behavior.html"><link rel="prefetch" href="../bower_components/iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../bower_components/iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../bower_components/paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../bower_components/paper-ripple/paper-ripple.html"><link rel="prefetch" href="../bower_components/paper-styles/default-theme.html"><link rel="prefetch" href="../bower_components/paper-styles/color.html"><link rel="prefetch" href="../bower_components/paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../bower_components/paper-material/paper-material-shared-styles.html"><link rel="prefetch" href="../bower_components/paper-styles/shadow.html"><link rel="prefetch" href="../bower_components/iron-range-behavior/iron-range-behavior.html"><link rel="prefetch" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html"></head><body><dom-module id="shop-addevent"><template><style include="shop-common-styles shop-button shop-form-styles shop-input shop-select shop-checkbox">.main-frame{transition:opacity 0.5s;}:host([waiting]) .main-frame{opacity:0.1;}paper-icon-button{color:var(--app-primary-color);}.logo{text-align:center;}.logo a{font-size:20px;font-weight:600;letter-spacing:0.3em;color:var(--app-white-color);text-decoration:none;display:inline-block;pointer-events:auto;}.left-bar-item{width:40px;}app-header{@apply (--layout-fixed-top);z-index:1;background-color:#1976D2;--app-header-shadow:{box-shadow:inset 0px 5px 6px -3px rgba(0, 0, 0, 0.2);height:10px;bottom:-10px;};}shop-input, shop-select{font-size:16px;}shop-select{margin-bottom:20px;}paper-spinner-lite{position:fixed;top:calc(50% - 14px);left:calc(50% - 14px);}progress{width:100%;margin-bottom:5px;-webkit-appearance:none;appearance:none;}.grid{margin-top:40px;@apply (--layout-horizontal);}.grid > section{@apply (--layout-flex);}.grid > section:not(:first-child){margin-left:80px;}.row{@apply (--layout-horizontal);@apply (--layout-end);}.column{@apply (--layout-vertical);}.fullwidth{width:100%;}.row > .flex,
      .input-row > *{@apply (--layout-flex);}.input-row > *:not(:first-child){margin-left:8px;}.shop-select-label{line-height:20px;}.order-summary-row{line-height:24px;}.total-row{font-weight:500;margin:30px 0;}@media (max-width: 767px){.grid{display:block;margin-top:0;}.grid > section:not(:first-child){margin-left:0;}}.enabled{border:1px solid #555;@apply (--file-upload-upload-border-enabled);}.hover{opacity:.7;border:1px dashed #111;@apply (--file-upload-upload-border-hover);}#UploadBorder{vertical-align:middle;color:#555;padding-top:20px;padding-bottom:20px;max-height:300px;width:100%;overflow-y:auto;margin-top:15px;display:inline-block;@apply (--file-upload-upload-border);}#dropArea{text-align:center;@apply (--file-upload-drop-area);}paper-button#button{margin-bottom:20px;@apply (--file-upload-button);}paper-button#button:hover{@apply (--file-upload-button-hover);}.file{padding:10px 0px;margin-left:15px;@apply (--file-upload-file);}.commands{float:right;margin-right:10px;@apply (--file-upload-commands);}.commands iron-icon:not([icon="check-circle"]){cursor:pointer;opacity:.9;@apply (--file-upload-commands-faded);}.commands iron-icon:hover{opacity:1;@apply (--file-upload-commands-hovered);}[hidden]{display:none;}.error{color:var(--error-color);font-size:11px;margin-top:2px;@apply (--file-upload-error);}.progress-bar{margin-top:2px;}paper-progress{--paper-progress-active-color:#03a9f4;}paper-progress[error]{--paper-progress-active-color:var(--error-color);}</style><firebase-auth id="auth" provider="email" signed-in="{{signedIn}}" user="{{user}}" on-error="handleError"></firebase-auth><firebase-document path="/users/[[user.uid]]" data="{{userprofile}}"></firebase-document><app-header role="navigation" id="header" effects="waterfall" hidden="[[!signedin]]" condenses="" reveals=""><app-toolbar><div class="left-bar-item"><paper-icon-button class="menu-btn" icon="menu" on-click="_toggleDrawer" aria-label="Categories"></paper-icon-button></div><div class="logo" main-title=""><a href="#/" aria-label="SHOP Home">PROJECTAGRAM</a></div></app-toolbar></app-header><div class="main-frame"><iron-pages selected="[[state]]" attr-for-selected="state"><div state="init"><form id="checkoutForm" is="iron-form" method="post" action="/data/sample_success_response.json" on-iron-form-response="_didReceiveResponse" on-iron-form-presubmit="_willSendRequest"><header class="subsection" visible$="{{hideFileListRe}}"><h1>Add Event</h1><span>Please fill all the details of the event...!!!!</span></header><div class="subsection grid" visible$="{{hideFileListRe}}"><section><h2 id="accountInfoHeading">Event Information</h2><div class="row input-row"><shop-input><input type="date" id="date" name="date" placeholder="Event Date" required="" aria-labelledby="dateLabel accountInfoHeading"><shop-md-decorator error-message="Invalid Date" aria-hidden="true"><label id="dateLabel">Date Of Event</label><shop-underline></shop-underline></shop-md-decorator></shop-input></div><div class="row input-row"><shop-input><input type="text" id="eventTitle" name="eventTitle" placeholder="Event Title" pattern="[0-9A-Za-z].{6,}" required="" aria-labelledby="eventTitleLabel accountInfoHeading"><shop-md-decorator error-message="More than 6 characters" aria-hidden="true"><label id="eventTitleLabel">Event Title</label><shop-underline></shop-underline></shop-md-decorator></shop-input></div><div class="row input-row"><shop-input><input type="text" id="eventDes" name="eventDes" pattern=".{5,}" placeholder="Phone Number" required="" aria-labelledby="accountPhoneLabel accountInfoHeading"><shop-md-decorator error-message="More than 5 characters" aria-hidden="true"><label id="accountPhoneLabel">Event Description</label><shop-underline></shop-underline></shop-md-decorator></shop-input></div><div class="row input-row"><div class="column"><label for="location">Location</label><shop-select><select id="location" name="location" required="" autocomplete="location" aria-label="Location"><option value="Mumbai" selected="">Mumbai</option><option value="Gurgaon">Gurgaon</option><option value="Bangalore">Bangalore</option><option value="Hyderabad">Hyderabad</option><option value="US">US</option></select><shop-md-decorator aria-hidden="true"><shop-underline></shop-underline></shop-md-decorator></shop-select></div></div></section><section><h2 id="otherInfoHeading">Upload Photos</h2><div class="row input-row"><shop-input><shop-button fullwidth="" id="button"><input class="fullwidth" type="button" id="button" on-click="_fileClick" value="Select Photos"></shop-button><div id="UploadBorder" hidden$="{{hideFileList}}"><div id="dropArea" hidden$="{{!_shownDropText}}">{{dropText}}</div><template is="dom-repeat" items="{{files}}"><div class="file"><div class="name"><span>{{item.name}}</span><div class="commands"><iron-icon icon="file-upload-icons:autorenew" title="{{retryText}}" on-click="_retryUpload" hidden$="{{!item.error}}"></iron-icon><iron-icon icon="file-upload-icons:cancel" title="{{removeText}}" on-click="_cancelUpload" hidden$="{{item.complete}}"></iron-icon><iron-icon icon="file-upload-icons:check-circle" title="{{successText}}" hidden$="{{!item.complete}}"></iron-icon></div></div><div class="error" hidden$="{{!item.error}}">{{errorText}}</div><div class="progress-bar" hidden$="{{progressHidden}}"><paper-progress value$="{{item.progress}}" error$="{{item.error}}"></paper-progress></div></div></template></div><input type="file" id="fileInput" on-change="_fileChange" hidden="" multiple="{{multi}}" accept="{{accept}}" required="" placeholder="Select Photos"></shop-input></div></section></div><shop-button fullwidth="" responsive="" id="submitBox"><input class="fullwidth" type="button" on-click="_submit" value="ADD EVENT"></shop-button></form></div><header state="success"><h1>Thank you</h1><p>[[response.successMessage]]</p><shop-button responsive=""><a href="#/home">Go to Home</a></shop-button></header><header state="error"><h1>We couldn´t add the user at this moment.</h1><p id="errorMessage">[[response.errorMessage]]</p><shop-button responsive=""><a href="#/adduser">Try again</a></shop-button></header></iron-pages></div><app-route route="[[route]]" pattern="/:state" on-active-changed="_activeRouteHandler"></app-route><paper-spinner-lite active="[[waiting]]"></paper-spinner-lite></template><script>Polymer({is:'shop-addevent',properties:{route:{type:Object,notify:!0},userprofile:Object,uploadedcnt:Number,state:{type:String,value:'init'},response:Object,visible:{type:Boolean,observer:'_visibleChanged'},fileType:{type:String,value:'image/jpeg'},waiting:{type:Boolean,readOnly:!0,reflectToAttribute:!0},accept:{type:String,value:'image/jpeg'},hideFileList:{type:Boolean,value:!1},hideFileListRe:{type:Boolean,value:!0},progressHidden:{type:Boolean,value:!1},droppable:{type:Boolean,value:!0},dropText:{type:String,value:'Drop Files Here(<= 10MB)'},multi:{type:Boolean,value:!0},files:{type:Array,notify:!0,value:function(){return[]}},raised:{type:Boolean,value:!0},noink:{type:Boolean,value:!1},retryText:{type:String,value:'Retry Upload'},removeText:{type:String,value:'Remove'},successText:{type:String,value:'Success'},errorText:{type:String,value:'Error uploading file...'},_shownDropText:{type:Boolean,value:!1},additional:{type:Object,value:{}},manualUpload:{type:Boolean,value:!0},fileDataName:{type:String,value:'file'},paperButtonAlt:{type:String,value:''},paperButtonTitle:{type:String,value:''},user:Object},_toggleDrawer:function(){this.fire('toggle-drawer',null)},_submit:function(){if(this._validateForm()){this.$.checkoutForm.fire('iron-form-presubmit',null,{bubbles:!1});var b=this.$.auth.app,c=-1*Date.now(),d=this.files[0],f={author:this.userprofile.name,uid:this.user.uid,description:this.$.eventDes.value,title:this.$.eventTitle.value,date:this.$.date.value,firstimage:d.name,_timestamp:c},g=b.database().ref().child('posts').push().key,h={};if(h['/posts/'+g]=f,h['/user-posts/'+this.user.uid+'/'+g]=f,b.database().ref().update(h),this.files){var j=this.files.length;this.uploadedcnt=0;for(var d,k=0;k<j;k++)d=this.files[k],this.uploadFileToServerTest(d,g)}}},_pushState:function(a){this._validState=a,this.set('route.path',a);Polymer.AppLayout.scroll({top:0,behavior:'silent'})},_activeRouteHandler:function(a){var b=a.target;if(a.detail.value){var c=b.data.state;if(this._validState===c)return this.state=c,void(this._validState='')}this.state='init'},_reset:function(){var a=this.$.checkoutForm;this._setWaiting(!1),a.reset(),this.set('files',[]),this.$.fileInput.value='',this._showDropText(),this.uploadedcnt=0;for(var b,c=0;b=a.elements[c],c<a.elements.length;c++)b.removeAttribute('aria-invalid')},_validateForm:function(){for(var c,a=this.$.checkoutForm,b=!1,d=0;c=a.elements[d],d<a.elements.length;d++)c.checkValidity()?c.removeAttribute('aria-invalid'):(b||(c.nextElementSibling&&this.fire('announce',c.nextElementSibling.getAttribute('error-message')),c.scrollIntoViewIfNeeded?c.scrollIntoViewIfNeeded():c.scrollIntoView(!1),c.focus(),b=!0),c.setAttribute('aria-invalid','true'));return!b},_willSendRequest:function(a){var b=a.target,c=b.request.body;this._setWaiting(!0)},_didReceiveResponse:function(a){var b=a.detail.response;this.response=b,this._setWaiting(!0),b.success?(this._pushState('success'),this._reset()):(this._pushState('error'),this._reset())},_computeHasItemRe:function(){return!0},_visibleChanged:function(a){a&&(this._reset(),this.fire('change-section',{title:'Add Event'}))},_toArray:function(a){return Object.keys(a).map(function(b){return{name:b,value:a[b]}})},target:{type:String,value:''},clear:function(){this.set('files',[]),this.$.fileInput.value='',this._showDropText()},ready:function(){this.raised&&this.toggleAttribute('raised',!0,this.$.button),this.noink&&this.toggleAttribute('noink',!0,this.$.button),this.droppable&&(this._showDropText(),this.setupDrop())},setupDrop:function(){var a=this.$.UploadBorder;this.toggleClass('enabled',!0,a),this.ondragover=function(b){b.stopPropagation(),this.toggleClass('hover',!0,a);var c=b.dataTransfer&&b.dataTransfer.dropEffect,d=b.dataTransfer&&b.dataTransfer.effectAllowed;return'none'===c&&'none'!==d&&(b.dataTransfer.dropEffect='move'===d?'move':'copy'),!1},this.ondragleave=function(){return this.toggleClass('hover',!1,a),!1},this.ondrop=function(b){if(this.toggleClass('hover',!1,a),b.preventDefault(),this.multi||0===this.files.length)for(var c=b.dataTransfer.files.length,d=0;d<c;d++){var f=b.dataTransfer.files[d],g=''===f.type?null:f.type.match(/^[^\/]*\//)[0],h=f.name.match(/\.[^\.]*$/)[0],j=f.size/1024/1024;(''===this.accept||!(10<j)||-1<this.accept.indexOf(g)||-1<this.accept.indexOf(h))&&(f.progress=0,f.error=!1,f.complete=!1,this.push('files',f),this.manualUpload||this.uploadFile(f))}}},_fileClick:function(){var a=this.$.fileInput;if(a&&document.createEvent){var b=document.createEvent('MouseEvents');b.initEvent('click',!0,!1),a.dispatchEvent(b)}},_fileChange:function(a){for(var b=a.target.files.length,c=0;c<b;c++){var d=a.target.files[c],f=d.size/1024/1024;10<f||(d.progress=0,d.error=!1,d.complete=!1,this.multi?this.push('files',d):this.set('files',[d]))}},_manualUpload:function(){if(this.files)for(var d,b=this.files.length,c=0;c<b;c++)d=this.files[c],this.uploadFile(d)},cancel:function(a){if(a){var b=this.$.auth.app,c='';c='posts/'+a.name;var d=b.storage().ref(c),f=d.put(a);f.cancel(),this.splice('files',this.files.indexOf(a),1),this._showDropText()}},_cancelUpload:function(a){this.cancel(a.model.__data__.item)},_retryUpload:function(a){a.model.set('item.error',!1),a.model.set('item.progress',0);var b=this;this.async(function(){b.uploadFile(a.model.__data__.item)},50)},_showDropText:function(){this.set('_shownDropText',!this.files.length&&this.droppable)},uploadFile:function(a){if(a){this.fire('before-upload'),this._showDropText();var b='files.'+this.files.indexOf(a),c=this,d=this.$.auth.app,f='';f='posts/'+a.name;var g=d.storage().ref(f),h=g.put(a);h.on('state_changed',function(k){var l=100*(k.bytesTransferred/k.totalBytes);c.set(b+'.progress',l)},function(){c.set(b+'.error',!0),c.set(b+'.complete',!1),c.set(b+'.progress',100),c.updateStyles()},function(){c.set(b+'.complete',!0)})}},uploadFileToServerTest:function(a,b){if(a){var c=this,d=this;this.resizeImage({file:a,maxSize:1200}).then(function(f){c.fire('before-upload'),c._showDropText();var g='files.'+c.files.indexOf(a),h=c.$.auth.app,j='';j='posts/'+b+'/'+a.name;var k=h.storage().ref(j),l=k.put(f);l.on('state_changed',function(n){var o=100*(n.bytesTransferred/n.totalBytes);d.set(g+'.progress',o)},function(){d.set(g+'.error',!0),d.set(g+'.complete',!1),d.set(g+'.progress',100),d.updateStyles()},function(){d.set(g+'.complete',!0);var n=c.$.auth.app,o=a.name;o=o.replace(/\.[^/.]+$/,''),n.database().ref().child('posts/'+b+'/images/'+o).set(a.name),n.database().ref().child('/user-posts/'+c.user.uid+'/'+b+'/images/'+o).set(a.name),++c.uploadedcnt;var p=c.files.length;p==c.uploadedcnt&&c.debounce('_submitForm',function(){c.$.checkoutForm.fire('iron-form-response',{response:{success:1,successMessage:'Event Added Successfully..!!'}},{bubbles:!1})},1e3)})}).catch(function(){})}},resizeImage:function(a){var b=a.file,c=a.maxSize,d=new FileReader,f=new Image,g=document.createElement('canvas'),h=function(k){for(var l=0<=k.split(',')[0].indexOf('base64')?atob(k.split(',')[1]):unescape(k.split(',')[1]),m=k.split(',')[0].split(':')[1].split(';')[0],n=l.length,o=new Uint8Array(n),p=0;p<n;p++)o[p]=l.charCodeAt(p);return new Blob([o],{type:m})},j=function(){var k=f.width,l=f.height;k>l?k>c&&(l*=c/k,k=c):l>c&&(k*=c/l,l=c),g.width=k,g.height=l,g.getContext('2d').drawImage(f,0,0,k,l);var m=g.toDataURL('image/jpeg');return h(m)};return new Promise(function(k,l){return b.type.match(/image.*/)?void(d.onload=function(m){f.onload=function(){return k(j())},f.src=m.target.result},d.readAsDataURL(b)):void l(new Error('Not an image'))})}});</script></dom-module></body></html>